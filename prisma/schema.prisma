generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model AdminUser{
  id String @id @default(uuid())
  email String @unique
  passwordHash String

  lastUpdatedCollections Collection[]
  lastUpdatedProducts    Product[]
  lastUpdatedPosts       Post[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

model Collection {
  id        String   @id @default(uuid())
  publicId  String   @unique @default(dbgenerated("concat('collection_', gen_random_uuid())"))
  name      String
  displayName String
  slug      String   @unique
  description String?

  products  CollectionProduct[]

  lastUpdatedById String?
  lastUpdatedBy AdminUser?  @relation(fields: [lastUpdatedById],references: [id])


  isPublished  Boolean  @default(true)
  isDeleted Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([publicId])
  @@index([slug])
  @@index([isPublished])
}



model Product {
  // identifier
  id        String   @id @default(uuid())
  publicId  String   @unique @default(dbgenerated("concat('product_', gen_random_uuid())"))
  sku       String   @unique
  slug      String   @unique

  //  about the product
  name      String
  displayName String
  type       String
  description String? @default("")
  assets     ProductAsset[]
  collections CollectionProduct[]
  orderedIn  OrderProduct[]
  addedToCart CartProduct[]



  // pricing
  price     Int   // selling price
  mrp       Int   // original price
  currency  String  @default("INR")
  
  
  // weight 
  weight    Int @default(0)
  weightUnit  String @default("g")

  // dimension
  height    Int @default(0)
  width     Int @default(0)
  breadth   Int @default(0)
  dimension  String @default("cm")

  /// serving size value
  servingSize Int @default(0)

  /// serving unit (g / ml)
  servingUnit String @default("g")


  // benefits
  healthBenefits String[]
  
  // nutrition (per serving or per 100g)
  /// calories in kilocalories (kcal)
  calories   Int @default(0)
  /// protein in grams (g)
  protein     Float @default(0)
  /// fiber in grams (g)
  fiber       Float @default(0)
  /// fat in grams (g)
  fat        Float @default(0)
  /// carbohydrates in grams (g)
  carbs       Float @default(0)
  /// sugar in grams (g)
  sugar       Float @default(0)
  /// potassium in milligrams (mg)
  potassium Int @default(0)
  /// sodium in milligrams (mg)
  sodium     Int @default(0)
  // visibility
  inStock    Boolean @default(true)
  isPublished Boolean @default(true)
  isFeatured  Boolean @default(false)
  isDeleted Boolean @default(false)

  lastUpdatedById String?
  lastUpdatedBy AdminUser?  @relation(fields: [lastUpdatedById],references: [id])


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([publicId])
  @@index([slug])
  @@index([sku])
  @@index([inStock])
  @@index([isPublished])
  @@index([isFeatured])
}

model CollectionProduct {
  collection   Collection @relation(fields: [collectionId], references: [id])
  collectionId String
  product      Product @relation(fields: [productId], references: [id])
  productId    String

  @@id([collectionId, productId])
  @@index([productId])
  @@index([collectionId])
}

model ProductAsset {
  id String @id @default(uuid())
  product      Product @relation(fields: [productId], references: [id])
  productId    String
  url     String
  thumbnail    String
  type AssetType @default(IMAGE)
  position     Int @default(0)
  isPrimary    Boolean @default(false)

  @@index([productId])
  @@index([isPrimary])
}

enum CartStatus{
  ACTIVE 
  CONVERTED
}

model Cart{
  id String @id @default(uuid())
  publicId String @unique @default(dbgenerated("concat('cart_', gen_random_uuid())"))
  userIdentifier  String?
  status CartStatus @default(ACTIVE)
  products CartProduct[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([publicId])
  @@index([status])
}

model CartProduct{
  cart        Cart @relation(fields: [cartId], references: [id])
  cartId      String
  product      Product @relation(fields: [productId], references: [id])
  productId    String
  quantity  Int     @default(1)

  @@id([cartId, productId])
  @@index([productId])
  @@index([cartId])
}

enum OrderStatus {
  PENDING      
  FAILED       
  ON_HOLD      
  PROCESSING   
  SHIPPED      
  DELIVERED    
  CANCELLED    
  REFUNDED     
}

model Order{
  id String @id @default(uuid())
  publicId String @unique @default(dbgenerated("concat('order_', gen_random_uuid())"))
  products OrderProduct[]
  status OrderStatus @default(PENDING)
  deliveryFee Int
  subTotal Int
  tax Int
  total Int 
  currency  String @default("INR")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt


  @@index([publicId])
  @@index([createdAt])
}

model OrderProduct {
  orderId   String
  productId String

  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  quantity  Int     @default(1)
  price     Int     
  currency  String @default("INR")

  @@id([orderId, productId])
  @@index([productId])
  @@index([orderId])
}


enum AssetType{
  IMAGE 
  VIDEO
}
model Post{
  id String @id @default(uuid())
  publicId String @unique  @default(dbgenerated("concat('post_', gen_random_uuid())"))
  slug String @unique

  title String @db.Text
  summary String @db.Text
  contentHTML String @db.Text
  
  assets PostAsset[]
  sharableLink String @unique

  isPublished Boolean @default(true)
  isDeleted Boolean @default(false)

  lastUpdatedById String? 

  lastUpdatedBy AdminUser? @relation(fields: [lastUpdatedById],references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([publicId])
  @@index([isPublished])
}


model PostAsset{
  id String @id @default(uuid())
  postId String 
  post Post @relation(fields: [postId],references: [id])
  url String
  thumbnail String
  type AssetType @default(IMAGE)
}